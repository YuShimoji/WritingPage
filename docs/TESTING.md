# TESTING — 手動検証手順

本プロジェクトはクライアントサイドのみで動作します。以下のチェックリストで主要機能を検証してください。

## 環境準備

- Node.js 20.x がインストールされていること
- `npm install` で依存関係をインストール

## 自動テスト

### スモークテスト

```bash
npm run test:smoke
```

- **期待結果**: 全てのチェックが `OK` となる。HTML構造、CSS/JSファイル、プラグイン/ガジェット機能、マークダウン構文などを検証。

### E2Eテスト（Playwright）

```bash
npm run test:e2e
```

- **期待結果**: 全てのテストケースが `PASS`。失敗時は `test-results/` にスクリーンショットとトレースが保存。
- **テスト内容**:
  - ガジェットパネルの表示/トグル/設定永続化/並び替え/インポートエクスポート
  - 同一オリジン埋め込み: setContent/getContent/focus/takeSnapshot
  - クロスオリジン埋め込み: postMessage を介した操作

### ビジュアルテスト（Puppeteer）

```bash
npm run test:puppeteer
```

- **前提**: 別ターミナルで `npm run dev` を実行し、`http://127.0.0.1:8080` でアプリが起動していること
- **期待結果**:
  - ブラウザウィンドウが開き、トップ画面が表示される
  - スクリーンショットが `test-screenshots/` に保存される（例: `initial-load.png`）

### リンター実行

```bash
npm run lint
```

- **期待結果**: ESLint と markdownlint がエラーなく完了。

## 事前準備

## 基本動作

- [ ] テキスト入力ができる
- [ ] 入力直後に LocalStorage に保存され、リロード後も内容が復元される
- [ ] 文字数/語数がツールバー中央に表示・更新される

## UI

- [ ] 左上「☰」でサイドバーの開閉ができる
- [ ] 「⌨️」でツールバー表示/非表示を切り替えできる（状態は保持される）
- [ ] ツールバー非表示時、右下に丸いボタン（⌨️ FAB）が現れ、それを押すとツールバーが再表示される
- [ ] 「⛶」でフルスクリーン切替が動作する
- [ ] 右下の⚙️ボタンでフォント調整パネル（フローティング）が開閉できる
- [ ] `Alt + W` でツールバー表示/非表示がトグルされる（再読込後も設定が保持される）
- [ ] ツールバーを非表示にした状態でリロードしても最初から非表示のまま（初期描画で`data-toolbar-hidden`が効く）
- [ ] ツールバーの表示/非表示を切り替えてもエディタの高さが大きく変動せず、画面が不自然に揺れない（sticky + padding-top）
- [ ] サイドバーの「テーマ」セクションが折りたたみ（details）になっている（初期は閉でOK）

## テーマ/配色

- [ ] プリセット（ライト/ダーク/セピア）が即時適用される
- [ ] ダークを選ぶとエディタ背景が暗色に、文字色が可読な明度に切り替わる
- [ ] カラーピッカーで背景色/文字色を変更できる（変更中はカスタム色が有効）
- [ ] 再読込後も設定が保持される
- [ ] 「カスタム色リセット」を押すと、プリセット既定の配色に戻る（再読込しても維持）

## タイポグラフィ

- [ ] フォントファミリーの切替が反映される
- [ ] フォントサイズのスライダーで数値と表示が連動する
- [ ] 行間スライダーで行間が変化する
- [ ] フローティングパネルのスライダー/数値入力で全体フォントサイズが変化する
- [ ] ショートカット `Ctrl/Cmd + + / - / 0` で拡大/縮小/初期化が機能する

## ドキュメント操作

- [ ] 「新規ドキュメント」で確認ダイアログが表示され、OKで内容がクリアされる
- [ ] 「テキストで保存」で `.txt` がダウンロードされる
- [ ] 「Markdownで保存」で `.md` がダウンロードされる
- [ ] 「ファイルを読み込む」で `.txt`/`.md` を選び、エディタに内容が反映される
- [ ] 「印刷」を押すとブラウザの印刷ダイアログが開き、画面UIが非表示・本文のみが印刷レイアウトで表示される

## アウトライン（部/章/節 等）

- [ ] プリセットの切替で挿入ボタンが更新される
- [ ] 「新しいプリセットを作成」でカンマ区切りを登録し、作成後に選択できる
- [ ] レベルの色を変更すると挿入ボタンの色が更新される
- [ ] 各レベルの挿入ボタンで、カーソル位置に見出しテンプレート（#〜######）が挿入される
- [ ] レベル行の「↑/↓」ボタンで順序を入れ替えでき、再表示/再読込しても順序が保持される

## ショートカット/入力補助

- [ ] `Ctrl/Cmd + S` で保存通知が表示される
- [ ] `Tab` でタブ文字が挿入される（フォーカスはエディタのまま）
- [ ] 入力中、左下にミニHUDで「文字数/語数」が短時間フェード表示される
- [ ] ミニHUDが入力中のみ表示される
- [ ] ツールバーが表示されている間は、ミニHUDは表示されない（併存しない）

### ミニHUD（小型表示）

- [ ] 表示位置を変更（左下→右下→左上→右上）すると位置が即時反映される（再読込後も保持）
- [ ] 表示時間（ms）を 300/1200/5000 などに変更すると、HUDのフェードアウトタイミングが変化する
- [ ] 背景色/文字色を変更すると即時反映される
- [ ] 不透明度スライダーの値とHUDの見た目が一致する（0〜1）
- [ ] HUDの表示位置が初期起動時に保持される
- [ ] HUDの表示時間が初期起動時に保持される
- [ ] HUDの背景色が初期起動時に保持される
- [ ] HUDの文字色が初期起動時に保持される
- [ ] HUDの不透明度が初期起動時に保持される
- [ ] 「HUDテスト表示」ボタンでHUDが現在の設定で一時表示される

## バックアップ（スナップショット）

- [ ] 「今すぐ保存」でスナップショットが1件追加され、一覧に日時と文字数が表示される
- [ ] 「復元」で本文がそのスナップショットの内容に置き換わる
- [ ] 「削除」で当該スナップショットが一覧から消える
- [ ] 入力を続け、2分以上経過かつ300文字以上変化したときに自動バックアップが追加される

## レスポンシブ

- [ ] 768px 以下でサイドバーが全幅スライド表示に切り替わる

## 既知の制約

- ブラウザ/端末間の同期は非対応
- [ ] 大容量テキストはブラウザのメモリ/LocalStorage制限の影響を受けます

## 埋め込み（Embed SDK）

- [ ] `scripts/dev-server.js` を起動し、`http://127.0.0.1:8080/embed-demo.html` を開く
- [ ] Demo 画面の `setContent()` で本文が埋め込みエディターへ反映される
- [ ] `getContent()` で埋め込みエディターの本文が取得できる
- [ ] `focus()` で `textarea#editor` にフォーカスが移動する
- [ ] `takeSnapshot()` でスナップショットが追加される

詳細な様式（前提/手順/失敗時の対処/回帰観点）は `docs/EMBED_TESTING.md` を参照してください。

## ガジェット設定のインポート/エクスポート

- [ ] サイドバー「ガジェット」セクションに以下のボタンが表示される
  - 「ガジェット設定をエクスポート」
  - 「ガジェット設定をインポート」
- [ ] 「エクスポート」ボタンで JSON ファイルがダウンロードされる
- [ ] ダウンロードした JSON を開き、`settings.Clock.hour24` を `false` に編集して保存
- [ ] 「インポート」ボタンから当該 JSON を選び、時計表示が 12時間表記に変わる
- [ ] 並び順や折りたたみ状態も JSON に沿って復元される

## 選択ツールチップ（仕様準備）

- [ ] テキスト選択時にツールチップが表示される（実装後）
- [ ] 太字/斜体/取り消し線/リンク/画像/区切り/ルビが仕様通りに挿入される（実装後）

## ドキュメント管理

- [ ] サイドバーの「ドキュメント」にドロップダウン（ドキュメント一覧）と「作成/改名/削除」ボタンが表示される
- [ ] 「作成」で新しい空のドキュメントが作られ、一覧に追加される
- [ ] 「改名」で現在のドキュメントの名前を変更でき、一覧に反映される
- [ ] 「削除」で現在のドキュメントを削除し、残っている場合は先頭のドキュメントに切り替わる
- [ ] それぞれのドキュメントで入力後に再読込すると、各ドキュメントの内容が保持されている
- [ ] 一覧は「最終更新日時の新しい順（降順）」で並ぶ（入力直後のドキュメントが上位に来る）
- [ ] 「新規ドキュメント」ボタンで新しいドキュメントが作成され、自動的に切り替わる（既存ドキュメントの内容は保持される）
- [ ] ドキュメントを切り替えただけでは並び順は変わらない（内容を更新した場合のみ並び順が変わる）

## エクスポート

- [ ] エクスポート（TXT/MD）のファイル名に現在のドキュメント名が含まれる（例: `MyNovel_YYYYMMDD_HHMMSS.txt`）
- [ ] ドキュメント名に含まれる無効文字（\\ / : \* ? " < > | など）がアンダースコアに置換される

## ブラウザタイトル

- [ ] 初期表示時に、現在のドキュメント名がタブタイトルに反映される（`<doc> - Zen Writer`）
- [ ] ドキュメントを切り替えると、タブタイトルも切り替わる
- [ ] ドキュメント名を改名すると、即座にタブタイトルに反映される
- [ ] 新規ドキュメント作成後、タブタイトルが新しいドキュメント名に更新される
- [ ] ドキュメント削除後、切替先のドキュメント名がタブタイトルに反映される

## 執筆目標（goal）

- [ ] サイドバーに「目標文字数」「締切（任意）」の入力欄が表示される
- [ ] 目標文字数を 1000 に設定すると、ツールバーの表示に「目標 1000 (0%)」が併記される
- [ ] 本文を入力していくと、パーセンテージが増加する
- [ ] 目標達成時に通知（右下トースト）が一度だけ表示される（HUDでも短時間表示）
- [ ] 締切を明日の日付に設定すると「残り1日」が併記される（翌日以降は「期限超過x日」）
- [ ] ページを再読込しても目標と締切が保持される

### 目標進捗バー（ツールバー内）

- [ ] 目標文字数を設定すると、ツールバー中央付近に細い進捗バーが表示される
- [ ] 入力文字数に応じてバーの長さ（%）が増加する
- [ ] 目標を 0（未設定）に戻すと、進捗バーは非表示になる
- [ ] スマホ幅（768px以下）では進捗バーは自動的に非表示になる
