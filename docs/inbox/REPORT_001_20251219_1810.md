# Report: Embed SDK の origin 検証と same-origin 判定の正規化（P0-1）

Ticket: docs/tasks/TASK_001_embed_sdk_origin_normalization.md
Completed: 2025-12-19T18:10:00+09:00

## Changes

- js/embed/zen-writer-embed.js: src の origin 推定（computedOrigin）・sameOrigin 自動判定・targetOrigin の安全側デフォルト・embed_origin 付与を実装
- docs/EMBED_SDK.md: sameOrigin 自動判定・embed_origin・origin 検証の説明を反映

## Decisions

- src を URL として解釈できる場合は origin を推定し、sameOrigin を自動判定する
- クロスオリジンの場合は targetOrigin（既定: src の origin）を必須とし、message 受信側で event.origin を照合する
- 子側の許可 origin 判定のため、既定で iframe src に embed_origin=<parent origin> を付与する

## Verification

- npm run test:smoke: ALL TESTS PASSED

## Remaining

- なし

## Handover

- 既存の embed-demo.html と child-bridge.js の期待動作（親→子: 親origin、子→親: 子origin）が一致していることを確認済み

## Proposals（任意）

- 今後: embed 側の options（appendEmbedOrigin/targetOrigin/sameOrigin）について、docs/EMBED_SDK.md に互換性の注意点を追記する余地あり
