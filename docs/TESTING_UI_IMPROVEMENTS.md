# UI改善項目のテスト手順

## テスト環境

- **ブラウザ**: Chrome/Firefox/Safari 最新版
- **開発サーバー**: `npm run dev` (<http://127.0.0.1:8080>)
- **前提条件**: localStorage をクリアして初期状態から開始推奨

## 1. OpenSpec仕様検証

### 1.1 OpenSpec Validation

**目的**: 仕様の整合性を確認

**手順**:

```bash
cd /path/to/WritingPage
openspec validate ui-future-enhancements --strict
```

**期待結果**:

- ✅ "Change 'ui-future-enhancements' is valid" と表示される
- ❌ エラーがある場合は仕様を修正

---

## 2. サイドバー展開時のレイアウト

### 2.1 サイドバー開閉とメインエリア表示

**目的**: サイドバー展開時にメインエリアが正しく表示される

**手順**:

1. <http://127.0.0.1:8080> にアクセス
2. ツールバー左端の「≡」ボタンをクリックしてサイドバーを開く
3. エディタエリアが見える状態を確認
4. サイドバー内のコンテンツをスクロール
5. サイドバーを閉じる（ツールバーの「×」または「≡」ボタン）

**期待結果**:

- ✅ サイドバーが320px幅で左から表示される
- ✅ メインエリアが右に320px分押し出される
- ✅ エディタキャンバス（白い領域）が中央に表示される
- ✅ エディタテキストが隠れたり見切れたりしない
- ✅ サイドバー開閉アニメーションがスムーズ（0.3s transition）

### 2.2 レスポンシブ確認

**手順**:

1. ブラウザ幅を狭くする（768px以下）
2. サイドバーを開く

**期待結果**:

- ✅ モバイル表示ではサイドバーが画面幅100%で表示される
- ✅ メインエリアの押し出しが発生しない（オーバーレイ表示）

---

## 3. カラーパレット（現在の色反映）

### 3.1 テーマプリセット選択時の色反映

**目的**: テーマ変更時にカラーピッカーが現在の色を表示する

**手順**:

1. サイドバーを開く
2. 「タイポ」タブをクリック
3. 「ライト」ボタンをクリック
4. 背景色ピッカーと文字色ピッカーの値を確認
5. 「ダーク」ボタンをクリック
6. 再度ピッカーの値を確認
7. 「セピア」ボタンをクリック
8. 再度ピッカーの値を確認

**期待結果**:

- ✅ ライトテーマ選択時:
  - 背景色ピッカー: `#ffffff`
  - 文字色ピッカー: `#333333`
- ✅ ダークテーマ選択時:
  - 背景色ピッカー: `#1e1e1e`
  - 文字色ピッカー: `#e0e0e0`
- ✅ セピアテーマ選択時:
  - 背景色ピッカー: `#f4ecd8`
  - 文字色ピッカー: `#5b4636`
- ✅ エディタの背景色・文字色がテーマに即座に反映される

### 3.2 カスタムカラー適用

**手順**:

1. 「タイポ」タブのカラーピッカーで背景色を変更（例: `#ffcccc`）
2. エディタの背景色が変わることを確認
3. 文字色ピッカーを変更（例: `#003300`）
4. エディタの文字色が変わることを確認
5. ページをリロード
6. 設定した色が保持されているか確認

**期待結果**:

- ✅ カラーピッカー変更が即座にエディタに反映される
- ✅ サイドバー・ツールバーの色も自動調整される（明度に応じて）
- ✅ リロード後も設定が保存されている
- ✅ カラーピッカーの値も正しく復元される

### 3.3 カラーリセット

**手順**:

1. カスタムカラーを設定した状態で「カラーをリセット」ボタンをクリック
2. テーマプリセットボタンをクリック（例: ライト）
3. カラーピッカーの値を確認

**期待結果**:

- ✅ リセット後、選択中のテーマの既定色に戻る
- ✅ カラーピッカーもテーマの既定色を表示

---

## 4. エディタキー移動時の振動修正

### 4.1 タイプライターモード有効時のスクロール

**目的**: キー入力時のスクロールがスムーズで振動しない

**手順**:

1. サイドバー → 「アシスト」タブ（設定セクション内）
2. 「タイプライターモード」の「有効化」チェックボックスをON
3. エディタで長文を入力（最低20行以上）
4. 矢印キー（↑↓）でカーソルを上下に移動
5. 素早く連続でキーを押す

**期待結果**:

- ✅ カーソルが画面の設定位置（デフォルト50%）に保たれる
- ✅ スクロールがスムーズ（smooth scroll behavior）
- ✅ 連続キー入力時にガクガク振動しない
- ✅ requestAnimationFrame によるデバウンスで滑らか

### 4.2 手動スクロール中の挙動

**手順**:

1. タイプライターモード有効のまま
2. マウスホイールまたはスクロールバーで手動スクロール
3. スクロール停止後、2秒待つ
4. エディタに文字を入力

**期待結果**:

- ✅ 手動スクロール中はタイプライター調整がスキップされる
- ✅ 2秒後に入力するとタイプライター調整が再開される
- ✅ スクロール位置が突然ジャンプしない

### 4.3 タイプライターモード無効時

**手順**:

1. 「タイプライターモード」の「有効化」チェックボックスをOFF
2. エディタで文字入力とキー移動

**期待結果**:

- ✅ 通常のエディタ動作（カーソル追従スクロール）
- ✅ 固定位置に保たれない

---

## 5. 統合テスト

### 5.1 設定の永続化

**手順**:

1. 以下の設定を変更:
   - テーマ: ダーク
   - カスタムカラー: 背景 `#112233`, 文字 `#aabbcc`
   - タイプライターモード: ON
   - アンカー位置: 0.6
2. ページをリロード（F5）
3. サイドバーを開いて各設定を確認

**期待結果**:

- ✅ 全ての設定が保存されている
- ✅ カラーピッカーの値も正しく表示される
- ✅ テーマプリセットボタンのアクティブ状態が正しい

### 5.2 Smoke Test

**手順**:

```bash
npm run test:smoke
```

**期待結果**:

- ✅ 全てのチェック項目が OK
- ✅ "CHECK gadgets M5" で DnD 関連は NG でも可（未実装機能）
- ✅ "CHECK embed=1 lightweight" で gadgets static が false でも可

---

## 6. E2E テスト（オプション）

### 6.1 Playwright実行

**手順**:

```bash
npm run test:e2e
```

**期待結果**:

- ✅ 既存のE2Eテストが全て合格
- ❌ 失敗した場合は該当機能を再確認

---

## 7. ブラウザ互換性テスト

### 7.1 複数ブラウザで動作確認

**テスト対象**:

- Chrome
- Firefox
- Safari (macOS)
- Edge

**確認項目**:

1. サイドバーアニメーション
2. カラーピッカーの動作
3. タイプライターモードのスムーズスクロール
4. localStorage による設定保存

**期待結果**:

- ✅ 全てのブラウザで正常動作
- ⚠️ Safari で一部CSS差異がある場合は許容範囲内か確認

---

## トラブルシューティング

### カラーピッカーが反映されない

- **原因**: theme.js の読み込み順序
- **対策**: index.html で theme.js が storage.js の後に読み込まれているか確認

### サイドバー展開時にエディタが隠れる

- **原因**: CSS の transition や width 計算
- **対策**: `html[data-sidebar-open] .main-content` の margin-left 値を確認

### タイプライターモードで振動する

- **原因**: requestAnimationFrame のキャンセル漏れ
- **対策**: `_typewriterScrollPending` が適切にクリアされているか確認

---

## テスト完了チェックリスト

- [ ] OpenSpec validation 合格
- [ ] サイドバー開閉が正常動作
- [ ] カラーピッカーがテーマ色を反映
- [ ] カスタムカラーが即座に適用される
- [ ] タイプライターモードがスムーズ
- [ ] 設定が永続化される
- [ ] Smoke test 合格
- [ ] 複数ブラウザで確認

---

**更新日**: 2025-01-11  
**テスト対象バージョン**: v0.3.17+
