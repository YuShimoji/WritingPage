<instruction>
あなたは分散開発チームの Worker です。割り当てられた 1 タスクだけを完遂し、証跡を残してください。
</instruction>

<context>
<mission_log>
作業開始時に `.cursor/MISSION_LOG.md` を読み込み、現在のフェーズと進捗を確認してください。
現在のフェーズ: Phase 5（Worker起動用プロンプト生成）完了、次フェーズ: Phase 4（Worker完了）または Phase 6（Orchestrator Report）
作業完了時に MISSION_LOG.md を更新し、進捗を記録してください。
</mission_log>

<ssot_reference>
Phase 0: 参照と整備
- SSOT: .shared-workflows/docs/Windsurf_AI_Collab_Rules_latest.md（無ければ docs/ 配下を参照し、必ず `ensure-ssot.js` で取得を試す）
- 進捗: docs/HANDOVER.md
- チケット: docs/tasks/TASK_013_shared_workflows_session_end_check_sync.md
- SSOT 未整備・ensure-ssot.js 不在で解決できない場合は停止条件
</ssot_reference>

<preconditions>
Phase 1: 前提の固定
- Tier: 2
- Branch: main
- Report Target: docs/inbox/REPORT_TASK_013_shared_workflows_session_end_check_sync_YYYYMMDD_HHMM.md
- GitHubAutoApprove: true（docs/HANDOVER.md の記述を参照）
- ブランチが異なる場合:
  - `git status -sb` で未コミットが無いことを確認
  - `git switch main` で切替を試す
  - 破壊的操作が必要なら停止条件
</preconditions>

<boundaries>
Phase 2: 境界
- Focus Area: scripts/session-end-check.js（プロジェクト側のスクリプトの更新）、docs/（変更内容のドキュメント化、必要に応じて）
- Forbidden Area: .shared-workflows/**（submodule内の変更は禁止、ただし既存スクリプトの使用は可能）、js/**（機能実装は本タスク対象外、スクリプトの統合のみ）
- DoD:
  - [ ] shared-workflows の session-end-check.js とプロジェクト側のスクリプトの差分を確認
  - [ ] 必要に応じてプロジェクト側のスクリプトを更新し、最新の機能を取り込む
  - [ ] 更新内容がドキュメント化されている（必要に応じて）
  - [ ] docs/inbox/ にレポート（REPORT_...md）が作成されている
  - [ ] 本チケットの Report 欄にレポートパスが追記されている
</boundaries>
</context>

<workflow>
<phase name="Phase 0: 参照と整備">
<step>
1. `.cursor/MISSION_LOG.md` を読み込み、現在のフェーズと進捗を確認。
2. SSOT: .shared-workflows/docs/Windsurf_AI_Collab_Rules_latest.md（無ければ docs/ 配下を参照し、必ず `ensure-ssot.js` で取得を試す）
3. 進捗: docs/HANDOVER.md
4. チケット: docs/tasks/TASK_013_shared_workflows_session_end_check_sync.md（**存在確認: `Test-Path docs/tasks/TASK_013_shared_workflows_session_end_check_sync.md` または `ls docs/tasks/TASK_013_shared_workflows_session_end_check_sync.md`**）
5. SSOT 未整備・ensure-ssot.js 不在で解決できない場合は停止条件
</step>
</phase>

<phase name="Phase 1: 前提の固定">
<step>
1. Tier: 2 を確認（機能実装、リファクタ）
2. Branch: main を確認（`git status -sb` で現在のブランチを確認）
3. Report Target: docs/inbox/REPORT_TASK_013_shared_workflows_session_end_check_sync_YYYYMMDD_HHMM.md（YYYYMMDD_HHMM は現在日時）
4. GitHubAutoApprove: docs/HANDOVER.md の記述を確認（GitHubAutoApprove: true の場合、PR作成後に自動マージを試みる）
5. ブランチが異なる場合:
   - `git status -sb` で未コミットが無いことを確認
   - `git switch main` で切替を試す
   - 破壊的操作が必要なら停止条件
</step>
</phase>

<phase name="Phase 2: 境界確認">
<step>
1. Focus Area を確認:
   - scripts/session-end-check.js（プロジェクト側のスクリプトの更新）
   - docs/（変更内容のドキュメント化、必要に応じて）
2. Forbidden Area を確認:
   - .shared-workflows/**（submodule内の変更は禁止、ただし既存スクリプトの使用は可能）
   - js/**（機能実装は本タスク対象外、スクリプトの統合のみ）
3. DoD を確認（チケットファイルの DoD セクションを参照）
</step>
</phase>

<phase name="Phase 3: 実装">
<step>
1. shared-workflows の session-end-check.js の存在確認:
   - `.shared-workflows/scripts/session-end-check.js` の存在を確認
   - スクリプトの内容を確認
2. プロジェクト側の session-end-check.js の存在確認:
   - `scripts/session-end-check.js` の存在を確認
   - スクリプトの内容を確認
3. 差分の確認:
   - 両者のスクリプトを比較し、差分を確認
   - 差分が大きい場合は、プロジェクト側のスクリプトを shared-workflows 版に置き換えることを検討
4. プロジェクト側のスクリプトを更新:
   - 必要に応じてプロジェクト側のスクリプトを更新し、最新の機能を取り込む
   - プロジェクト固有の設定がある場合は、それを保持
5. 動作確認:
   - スクリプトを実行し、正常に動作することを確認
   - 主要パスのみテスト（拡張テストは後続チケットへ分離）
6. 更新内容のドキュメント化（必要に応じて）:
   - docs/ に変更内容を記載
   - 既存のドキュメントに追記するか、新規作成するか判断
</step>
</phase>

<phase name="Phase 4: レポート作成">
<step>
1. レポートファイルを作成: docs/inbox/REPORT_TASK_013_shared_workflows_session_end_check_sync_YYYYMMDD_HHMM.md
2. レポート形式: REPORT_CONFIG.yml の standard スタイルに準拠
   - 必須ヘッダー: 概要、現状、次のアクション
   - その他の推奨ヘッダー: 実施内容、変更ファイル、DoD 達成状況、検証
3. レポート検証: `node scripts/report-validator.js docs/inbox/REPORT_TASK_013_shared_workflows_session_end_check_sync_YYYYMMDD_HHMM.md REPORT_CONFIG.yml .`
4. チケットの Report 欄にレポートパスを追記: docs/inbox/REPORT_TASK_013_shared_workflows_session_end_check_sync_YYYYMMDD_HHMM.md
5. チケットの Status を DONE に更新（DoD がすべて達成されている場合）
</step>
</phase>

<phase name="Phase 5: コミットとプッシュ">
<step>
1. 変更をステージ: `git add <変更ファイル>`
2. コミット: `git commit -m "feat: sync session-end-check.js with shared-workflows (TASK_013)"`
3. プッシュ: `git push origin main`
4. PR作成（Tier 2 の場合）:
   - `gh pr create --title "feat: sync session-end-check.js with shared-workflows (TASK_013)" --body "TASK_013 の完了: shared-workflows の session-end-check.js とプロジェクト側の同期"`
   - GitHubAutoApprove: true の場合、自動マージを試みる
   - 自動マージが失敗した場合、手動マージを待つ
</step>
</phase>
</workflow>

<stop_conditions>
- SSOT 未整備・ensure-ssot.js 不在で解決できない場合
- ブランチ切替に破壊的操作が必要な場合
- Forbidden Area に触れる必要がある場合
- 仮定が3つ以上必要な場合
- 前提を覆す変更が必要な場合
</stop_conditions>

<deliverables>
- レポート: docs/inbox/REPORT_TASK_013_shared_workflows_session_end_check_sync_YYYYMMDD_HHMM.md
- 更新されたスクリプト: scripts/session-end-check.js
- ドキュメント: docs/（変更内容のドキュメント化、必要に応じて）
</deliverables>
