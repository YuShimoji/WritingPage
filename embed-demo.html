<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Zen Writer Embed Demo</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg" />
    <style>
      body {
        font-family: system-ui, sans-serif;
        margin: 0;
        padding: 0;
      }
      header {
        padding: 12px 16px;
        border-bottom: 1px solid #ddd;
      }
      main {
        display: grid;
        grid-template-columns: 1fr 360px;
        gap: 12px;
        padding: 12px;
        height: calc(100vh - 58px);
        box-sizing: border-box;
      }
      #zw-container {
        border: 1px solid #ddd;
        border-radius: 8px;
        overflow: hidden;
      }
      aside {
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 12px;
      }
      label {
        display: block;
        margin-top: 8px;
      }
      textarea {
        width: 100%;
        height: 140px;
      }
      button {
        margin-top: 8px;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Zen Writer Embed Demo</h1>
    </header>
    <main>
      <div id="zw-container"></div>
      <aside>
        <div>
          <label>本文を設定</label>
          <textarea id="src-text">## タイトル\n\nここから本文…</textarea>
          <button id="btn-set">setContent()</button>
        </div>
        <div>
          <button id="btn-get">getContent()</button>
          <pre
            id="out"
            style="
              white-space: pre-wrap;
              background: #f7f7f7;
              padding: 8px;
              height: 120px;
              overflow: auto;
            "
          ></pre>
        </div>
        <div>
          <button id="btn-focus">focus()</button>
          <button id="btn-snap">takeSnapshot()</button>
        </div>
        <div>
          <strong>Events</strong>
          <pre
            id="events"
            style="
              white-space: pre-wrap;
              background: #f7f7f7;
              padding: 8px;
              height: 120px;
              overflow: auto;
            "
          ></pre>
        </div>
      </aside>
    </main>
    <script src="js/embed/zen-writer-embed.js"></script>
    <script>
      const sdk = ZenWriterEmbed.create('#zw-container', {
        src: '/index.html?embed=1',
        width: '100%',
        height: '100%',
      });
      const ev = document.getElementById('events');
      function log(msg) {
        const t = new Date().toLocaleTimeString();
        ev.textContent = `[${t}] ${msg}\n` + ev.textContent;
      }
      // subscribe events
      sdk.on('contentChanged', (p) =>
        log(`contentChanged len=${(p && p.len) || 0}`),
      );
      sdk.on('snapshotCreated', () => log('snapshotCreated'));
      document.getElementById('btn-set').addEventListener('click', async () => {
        const t = document.getElementById('src-text').value;
        await sdk.setContent(t);
        await sdk.focus();
      });
      document.getElementById('btn-get').addEventListener('click', async () => {
        const text = await sdk.getContent();
        document.getElementById('out').textContent = text;
      });
      document
        .getElementById('btn-focus')
        .addEventListener('click', async () => {
          await sdk.focus();
        });
      document
        .getElementById('btn-snap')
        .addEventListener('click', async () => {
          await sdk.takeSnapshot();
          alert('Snapshot saved in embedded app');
        });
    </script>
  </body>
</html>
